:root{
  --page-width:210mm;
  --page-height:297mm;
  --header-max-h:3cm;
  --left-col-w:4cm;        /* colonne gauche = 4 cm */
  --measure-size:1.5cm;
  --gap-between-parts:3mm;
  --right-margin:1.5cm;    /* marge droite = 1.5 cm */
  --gray:#CECECE;
  --filled-bg:#ffffff;
  font-family: "Arial", sans-serif;
  font-size:12pt; /* corps 12 */
}

*{box-sizing:border-box}

body{
  margin:0;
  display:flex;
  min-height:100vh;
  background:#f4f4f4;
  color:#111;
}

/* Controls sidebar - not printed */
#controls{
  width:260px;
  padding:16px;
  background:#fff;
  border-right:1px solid #ddd;
  overflow:auto;
}

/* Page container */
#a4, #page-wrap{flex:1; display:flex; justify-content:center; align-items:flex-start; padding:20px}

/* A4 page */
.a4page{
  width:var(--page-width);
  height:var(--page-height);
  background:white;
  box-shadow:0 2px 8px rgba(0,0,0,0.2);
  padding:8mm;
  padding-right: var(--right-margin); /* right margin 1.5cm */
  display:flex;
  flex-direction:column;
  gap:6mm;
  overflow:hidden;
}

/* Header */
#page-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  max-height:var(--header-max-h);
  min-height:2.2cm;
  gap:8px;
}
#title-area{ flex:1 1 auto; display:flex; flex-direction:column; }
#title-area input{ border:none; border-bottom:1px solid #000; font-size:12pt; padding:2px; width:100%; background:transparent; }
#tempo-area{ width:6.5cm; display:flex; align-items:center; gap:6px; }
#tempo{ width:80px; }

/* Body: left column (noms) + right column (grilles) */
#page-body{
  display:flex;
  gap:0; /* no extra horizontal gap so measures align on left edge of grid column */
  flex:1 1 auto;
  align-items:flex-start;
}

/* left col inside page (4cm) */
.left-column{
  width:var(--left-col-w);
  padding-right:4mm;
  display:flex;
  flex-direction:column;
  gap:var(--gap-between-parts);
  align-items:flex-start;
}

/* grid column */
.grid-column{
  flex:1 1 auto;
  min-width:0;
  padding-left:0;      /* ensures measures start at grid left edge */
  display:flex;
  flex-direction:column;
  gap:var(--gap-between-parts);
}

/* part-name area (left column entries) */
.part-name{
  width:100%;
  display:flex;
  align-items:center;
  padding-left:4mm;
  font-weight:bold;
  box-sizing:border-box;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* highlight selected left name */
.part-name.selected-part-left{
  background: rgba(169,208,255,0.3);
  border-radius:2px;
  padding-right:4px;
}

/* grid for measures (each part) */
.part-grid{
  display:flex;
  flex-direction:column;
  gap:4px;
  align-items:flex-start; /* left aligned so first measure starts at left edge */
}

/* each measure-row */
.measure-row{
  display:flex;
  gap:4px;
  align-items:flex-start;
}

/* measure (square) */
.measure{
  width:var(--measure-size);
  height:var(--measure-size);
  border:1px solid #000;
  background:var(--gray);
  position:relative;
  font-size:12pt;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:2px;
  overflow:visible;
  box-sizing:border-box;
}

/* filled */
.measure.filled{ background:var(--filled-bg); }

/* oval chord style inside measure */
.chord-oval{
  display:inline-block;
  padding:2px 6px;
  border-radius:999px;
  background:#fff;
  border:1px solid #000;
  color:#000;
  font-weight:normal;
  font-size:12pt;
  line-height:1;
}

/* split diagonal line and two text areas */
.measure.split{
  background:transparent;
  padding:0;
}
.split-svg{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
}
.split-text {
  position:absolute;
  width:50%;
  padding:2px;
  font-size:12pt;
  color:#000;
}
.split-text.top-left{ top:2px; left:2px; text-align:left; }
.split-text.bottom-right{ bottom:2px; right:2px; text-align:right; }

/* footer */
#page-footer{ margin-top:auto; }
#comments{
  width:100%;
  font-size:12pt;
  resize:none;
  border:1px solid #000;
  padding:6px;
  height:calc(1.2em * 4 + 12px);
}

/* Editor modal */
.modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.3); z-index:1000; }
.modal[aria-hidden="true"]{ display:none; }
.modal-content{ background:#fff; padding:12px; border-radius:6px; width:320px; }
.modal-content .row{margin-top:8px;}
.actions{display:flex; gap:8px; justify-content:flex-end; margin-top:12px}

/* Print rules: hide controls, show page exactly */
@media print{
  body{background:#fff}
  #controls, .modal{display:none !important}
  .a4page{ box-shadow:none; margin:0; padding:8mm; padding-right: var(--right-margin); page-break-after:always; }
  @page { size: A4; margin: 0; }
}